<!-- [OVERHAUL] index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Studio</title>
    <link rel="stylesheet" href="index.css">
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.4.0",
    "diff": "https://esm.sh/diff@^8.0.2",
    "jszip": "https://esm.sh/jszip@^3.10.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="preloader">
        <div class="spinner"></div>
    </div>
    <div class="background-container">
        <div class="background-gradient"></div>
        <div class="background-noise"></div>
    </div>

    <div id="root">
        <div id="app-container">
            <aside id="controls-sidebar" class="inspector-panel custom-scrollbar" aria-labelledby="controls-sidebar-heading">
                <header class="sidebar-header">
                    <h1 id="controls-sidebar-heading">Gemini Studio</h1>
                    <p id="api-key-status" class="api-key-status-message status-badge" aria-live="polite">Initializing...</p>
                    <div id="api-key-form-container" style="display: none; margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.75rem;">
                        <input type="password" id="api-key-input" class="input-base" placeholder="Enter API Key">
                        <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                            <button id="save-api-key-button" class="button">Save Key</button>
                            <button id="clear-api-key-button" class="button">Clear Key</button>
                        </div>
                    </div>
                </header>
                
                <div class="sidebar-content">
                    <div class="input-group">
                        <label for="initial-idea" id="initial-idea-label" class="input-label">Your Request:</label>
                        <textarea id="initial-idea" class="input-base" placeholder="E.g., a personal blog about cooking..." rows="5"></textarea>
                    </div>
        
                    <div id="math-problem-image-input-container" class="input-group" style="display: none;">
                        <label for="math-problem-image-input" class="input-label">Upload Image (Optional):</label>
                        <input type="file" id="math-problem-image-input" class="input-base file-input" accept="image/png, image/jpeg, image/webp">
                        <img id="math-problem-image-preview" src="#" alt="Image preview" style="display: none; max-width: 100%; height: auto; border-radius: var(--border-radius-md); margin-top: 1rem;"/>
                    </div>
        
                    <div class="input-group">
                        <label class="input-label">Application Mode</label>
                        <div id="app-mode-selector" class="radio-group-modern" role="radiogroup" aria-label="Select Application Mode">
                           <label class="radio-label-modern">
                                <input type="radio" name="appMode" value="website" checked>
                                <span>HTML</span>
                            </label>
                            <label class="radio-label-modern">
                                <input type="radio" name="appMode" value="creative">
                                <span>Writing</span>
                            </label>
                            <label class="radio-label-modern">
                                <input type="radio" name="appMode" value="math">
                                <span>Math</span>
                            </label>
                            <label class="radio-label-modern">
                                <input type="radio" name="appMode" value="agent">
                                <span>Agent</span>
                            </label>
                            <label class="radio-label-modern">
                                <input type="radio" name="appMode" value="react">
                                <span>React</span>
                            </label>
                        </div>
                    </div>
                    
                    <details class="sidebar-section" open>
                        <summary class="sidebar-section-header">Model & Variants</summary>
                        <div class="sidebar-section-content">
                            <div id="model-selection-container" class="input-group-tight">
                                <label for="model-select" class="input-label">Model:</label>
                                <select id="model-select" class="input-base" aria-label="Select Gemini Model">
                                    <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                    <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                </select>
                            </div>
                
                            <div id="temperature-selection-container" class="input-group-tight">
                                <label class="input-label" id="pipeline-select-heading">Variants (Temperature):</label>
                                <div id="pipeline-selectors-container" class="pipeline-selectors-container" role="group" aria-labelledby="pipeline-select-heading">
                                </div>
                            </div>
                        </div>
                    </details>

                    <details class="sidebar-section">
                        <summary class="sidebar-section-header">Configuration</summary>
                        <div class="sidebar-section-content">
                            <div class="config-buttons-container" style="display: flex; gap: 1rem;">
                                <button id="export-config-button" class="button" type="button">Export</button>
                                <input type="file" id="import-config-input" class="sr-only" accept=".json">
                                <label for="import-config-input" id="import-config-label" class="button" role="button" tabindex="0">
                                    <span>Import</span>
                                </label>
                            </div>
                        </div>
                    </details>
                    
                    <div id="custom-prompts-section" class="sidebar-section">
                        <div id="customize-prompts-trigger" role="button" tabindex="0" class="sidebar-section-header">
                            Customize Prompts
                        </div>
                    </div>

                </div>

                <footer class="sidebar-footer">
                    <button id="generate-button" class="button primary-action" type="button">Generate</button>
                </footer>
            </aside>
    
            <main id="main-content" class="flow-canvas-wrapper" aria-labelledby="main-content-heading">
                <h2 id="main-content-heading" class="sr-only">Generation Pipelines Output</h2>
                <div id="tabs-nav-container" class="tabs-container" role="tablist" aria-label="Generation Variants">
                    <!-- Tabs will be dynamically inserted here -->
                </div>
                <div id="pipelines-content-container" class="results-content-area custom-scrollbar">
                    <!-- Pipeline content will be dynamically inserted here -->
                </div>
            </main>
        </div>
    </div>
    
    <!-- Prompts Modal -->
    <div id="prompts-modal-overlay" class="modal-overlay">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="prompts-modal-title">
            <header class="modal-header">
                <h2 id="prompts-modal-title" class="modal-title">Customize Prompts</h2>
                <button id="prompts-modal-close-button" class="modal-close-button" aria-label="Close Custom Prompts">&times;</button>
            </header>
            <div id="prompts-modal-body" class="modal-body">
                <p class="custom-prompts-description">
                    Customize system instructions and user prompt templates for each generation step of the selected application mode.
                </p>
                <div id="prompts-modal-layout" class="prompts-modal-layout">
                    <nav id="prompts-modal-nav" class="prompts-nav custom-scrollbar"></nav>
                    <div id="prompts-modal-content" class="prompts-content custom-scrollbar">
                        <!-- Website Prompts -->
                        <div id="website-prompts-container" class="prompts-mode-container">
                            <div class="prompt-content-pane" data-prompt-key="initial-gen">
                                <h4 class="prompt-pane-title">1. Initial HTML Generation</h4>
                                <div class="input-group-tight"><label for="sys-initial-gen" class="prompt-label">System Instruction:</label><textarea id="sys-initial-gen" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-initial-gen" class="prompt-label">User Prompt (<code>{{initialIdea}}</code>):</label><textarea id="user-initial-gen" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                             <div class="prompt-content-pane" data-prompt-key="initial-bugfix">
                                <h4 class="prompt-pane-title">2. Initial HTML Bug Fix & Polish</h4>
                                <div class="input-group-tight"><label for="sys-initial-bugfix" class="prompt-label">System Instruction:</label><textarea id="sys-initial-bugfix" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-initial-bugfix" class="prompt-label">User Prompt (<code>{{initialIdea}}</code>, <code>{{rawHtml}}</code>):</label><textarea id="user-initial-bugfix" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="initial-features">
                                <h4 class="prompt-pane-title">3. Initial Feature Suggestion (HTML)</h4>
                                <div class="input-group-tight"><label for="sys-initial-features" class="prompt-label">System Instruction:</label><textarea id="sys-initial-features" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-initial-features" class="prompt-label">User Prompt (<code>{{initialIdea}}</code>, <code>{{currentHtml}}</code>):</label><textarea id="user-initial-features" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="refine-implement">
                                <h4 class="prompt-pane-title">4. Refinement - Stabilize & Implement</h4>
                                <div class="input-group-tight"><label for="sys-refine-implement" class="prompt-label">System Instruction:</label><textarea id="sys-refine-implement" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-refine-implement" class="prompt-label">User Prompt (<code>{{currentHtml}}</code>, <code>{{featuresToImplementStr}}</code>):</label><textarea id="user-refine-implement" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="refine-bugfix">
                                <h4 class="prompt-pane-title">5. Refinement - Bug Fix & Completion</h4>
                                <div class="input-group-tight"><label for="sys-refine-bugfix" class="prompt-label">System Instruction:</label><textarea id="sys-refine-bugfix" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-refine-bugfix" class="prompt-label">User Prompt (<code>{{rawHtml}}</code>):</label><textarea id="user-refine-bugfix" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="refine-features">
                                <h4 class="prompt-pane-title">6. Refinement - Feature Suggestion</h4>
                                <div class="input-group-tight"><label for="sys-refine-features" class="prompt-label">System Instruction:</label><textarea id="sys-refine-features" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-refine-features" class="prompt-label">User Prompt (<code>{{initialIdea}}</code>, <code>{{currentHtml}}</code>):</label><textarea id="user-refine-features" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="final-polish">
                                <h4 class="prompt-pane-title">7. Final Polish (HTML)</h4>
                                <div class="input-group-tight"><label for="sys-final-polish" class="prompt-label">System Instruction:</label><textarea id="sys-final-polish" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-final-polish" class="prompt-label">User Prompt (<code>{{currentHtml}}</code>):</label><textarea id="user-final-polish" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                        </div>
                        <div id="creative-prompts-container" class="prompts-mode-container">
                            <div class="prompt-content-pane" data-prompt-key="creative-initial-draft">
                                <h4 class="prompt-pane-title">1. Initial Draft Generation</h4>
                                <div class="input-group-tight"><label for="sys-creative-initial-draft" class="prompt-label">System Instruction:</label><textarea id="sys-creative-initial-draft" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-creative-initial-draft" class="prompt-label">User Prompt (<code>{{initialPremise}}</code>):</label><textarea id="user-creative-initial-draft" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="creative-initial-critique">
                                <h4 class="prompt-pane-title">2. Initial Critique & Suggestion</h4>
                                <div class="input-group-tight"><label for="sys-creative-initial-critique" class="prompt-label">System Instruction:</label><textarea id="sys-creative-initial-critique" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-creative-initial-critique" class="prompt-label">User Prompt (<code>{{currentDraft}}</code>):</label><textarea id="user-creative-initial-critique" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="creative-refine-revise">
                                <h4 class="prompt-pane-title">3. Refinement - Revise Draft</h4>
                                <div class="input-group-tight"><label for="sys-creative-refine-revise" class="prompt-label">System Instruction:</label><textarea id="sys-creative-refine-revise" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-creative-refine-revise" class="prompt-label">User Prompt (<code>{{currentDraft}}</code>, <code>{{critiqueToImplementStr}}</code>):</label><textarea id="user-creative-refine-revise" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="creative-refine-critique">
                                <h4 class="prompt-pane-title">4. Refinement - New Critique</h4>
                                <div class="input-group-tight"><label for="sys-creative-refine-critique" class="prompt-label">System Instruction:</label><textarea id="sys-creative-refine-critique" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-creative-refine-critique" class="prompt-label">User Prompt (<code>{{currentDraft}}</code>):</label><textarea id="user-creative-refine-critique" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="creative-final-polish">
                                <h4 class="prompt-pane-title">5. Final Polish (Creative Writing)</h4>
                                <div class="input-group-tight"><label for="sys-creative-final-polish" class="prompt-label">System Instruction:</label><textarea id="sys-creative-final-polish" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-creative-final-polish" class="prompt-label">User Prompt (<code>{{currentDraft}}</code>):</label><textarea id="user-creative-final-polish" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                        </div>
                        <div id="math-prompts-container" class="prompts-mode-container">
                            <div class="prompt-content-pane" data-prompt-key="math-initial-strategy">
                                <h4 class="prompt-pane-title">1. Initial Strategy Generation</h4>
                                <div class="input-group-tight"><label for="sys-math-initial-strategy" class="prompt-label">System Instruction:</label><textarea id="sys-math-initial-strategy" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-math-initial-strategy" class="prompt-label">User Prompt (<code>{{originalProblemText}}</code>):</label><textarea id="user-math-initial-strategy" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="math-sub-strategy">
                                <h4 class="prompt-pane-title">2. Sub-Strategy Generation</h4>
                                <div class="input-group-tight"><label for="sys-math-sub-strategy" class="prompt-label">System Instruction:</label><textarea id="sys-math-sub-strategy" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-math-sub-strategy" class="prompt-label">User Prompt (<code>...</code>):</label><textarea id="user-math-sub-strategy" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                            <div class="prompt-content-pane" data-prompt-key="math-solution-attempt">
                                <h4 class="prompt-pane-title">3. Solution Attempt</h4>
                                <div class="input-group-tight"><label for="sys-math-solution-attempt" class="prompt-label">System Instruction:</label><textarea id="sys-math-solution-attempt" class="input-base prompt-textarea" rows="5"></textarea></div>
                                <div class="input-group-tight"><label for="user-math-solution-attempt" class="prompt-label">User Prompt (<code>...</code>):</label><textarea id="user-math-solution-attempt" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                        </div>
                        <div id="agent-prompts-container" class="prompts-mode-container">
                           <div class="prompt-content-pane" data-prompt-key="agent-judge-llm">
                                <h4 class="prompt-pane-title">Agent Mode: Judge LLM Config</h4>
                                <div class="input-group-tight"><label for="sys-agent-judge-llm" class="prompt-label">System Instruction (for Judge LLM):</label><textarea id="sys-agent-judge-llm" class="input-base prompt-textarea" rows="8"></textarea></div>
                                <div class="input-group-tight"><label for="user-agent-judge-llm" class="prompt-label">User Prompt Template (for Judge LLM):</label><textarea id="user-agent-judge-llm" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                        </div>
                        <div id="react-prompts-container" class="prompts-mode-container">
                           <div class="prompt-content-pane" data-prompt-key="react-orchestrator">
                                <h4 class="prompt-pane-title">React: Orchestrator Agent Config</h4>
                                <div class="input-group-tight"><label for="sys-react-orchestrator" class="prompt-label">System Instruction (for Orchestrator):</label><textarea id="sys-react-orchestrator" class="input-base prompt-textarea" rows="8"></textarea></div>
                                <div class="input-group-tight"><label for="user-react-orchestrator" class="prompt-label">User Prompt Template (for Orchestrator):</label><textarea id="user-react-orchestrator" class="input-base prompt-textarea" rows="3"></textarea></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="index.tsx"></script>

    <!-- Diff Viewer Modal -->
    <div id="diff-modal-overlay" class="modal-overlay">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="diff-modal-title">
            <header class="modal-header">
                <h2 id="diff-modal-title" class="modal-title">Compare Outputs</h2>
                <button id="diff-modal-close-button" class="modal-close-button" aria-label="Close Diff Viewer">&times;</button>
            </header>
            <div id="diff-modal-body" class="diff-modal-body">
                <aside id="diff-selector-panel" class="inspector-panel custom-scrollbar">
                    <div id="diff-source-display" class="input-group">
                        <h4 class="model-section-title">Source (A)</h4>
                        <p id="diff-source-label">None selected</p>
                    </div>
                    <hr class="modal-divider"/>
                    <div class="input-group">
                        <h4 class="model-section-title">Select Target (B)</h4>
                        <div id="diff-target-tree"></div>
                    </div>
                </aside>
                <div id="diff-viewer-panel">
                    <div class="diff-no-selection">
                        <p>Select a target from the list to view differences.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script type="module" src="/index.tsx"></script>
</body>
</html>
